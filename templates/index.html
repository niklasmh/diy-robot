<!DOCTYPE html>
<html>
  <head>
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@600&display=swap" rel="stylesheet" />
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet" />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
      integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
      crossorigin="anonymous"
    ></script>
  </head>
  <style>
    body {
      font-family: "Open Sans";
      background-color: #1e1e1eee;
    }
    button,
    input {
      font-size: 3rem;
      max-width: 480px;
      width: 100%;
    }
    img {
      max-width: 480px;
      min-width: 240px;
      image-rendering: pixelated;
    }
  </style>
  <body onload="refreshImage()" class="min-h-screen py-1 text-gray-300">
    <div id="app"></div>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/components/prism-json.min.js"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/prop-types@15.7.2/prop-types.js" crossorigin></script>
    <script src="https://unpkg.com/state-local@1.0.7/lib/umd/state-local.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/javascript" charset="utf-8">
      var socket = io();
      function sendCommand(scale = 1) {
        const prefix = scale < 0 ? "-" : "";
        const position = document.getElementById("position").value;
        socket.emit("move", prefix + position);
      }
      function locate() {
        socket.emit("locate");
      }
      function relocate() {
        const lower = document.getElementById("lower").value.replace(",", ".");
        const upper = document.getElementById("upper").value.replace(",", ".");
        socket.emit("relocate", lower + "," + upper);
      }
      socket.on("position", (position) => {
        document.getElementById("position").value = position;
        refreshImage();
      });
      socket.on("position-failed", (message) => {
        console.log(message);
        refreshImage();
      });
      function refreshImage() {
        document.getElementById("camera").src = "/static/camera.png?" + +new Date();
        document.getElementById("canny-camera").src = "/static/canny_camera.png?" + +new Date();
      }
    </script>
    <script type="text/babel" data-type="module">
      function App() {
        return <div className="container flex flex-col gap-8 mx-auto pb-20">Niiice</div>;
      }

      ReactDOM.render(<App className="" />, document.querySelector("#app"));
    </script>
    <input id="position" value="10,0" />
    <button onclick="sendCommand()">Move up</button>
    <button onclick="sendCommand(-1)">Move down</button>
    <br />
    <button onclick="locate()">Locate</button>
    <br />
    <input id="lower" value="40" type="number" />
    <input id="upper" value="20" type="number" />
    <button onclick="relocate()">Relocate</button>
    <br />
    <img id="camera" src="/static/camera.png" />
    <img id="canny-camera" src="/static/canny_camera.png" />
  </body>
</html>
